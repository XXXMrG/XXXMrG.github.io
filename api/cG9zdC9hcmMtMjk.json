{"title":"看破 React-Router v4","date":"2019-07-18T13:21:56.000Z","thumbnail":"https://i.loli.net/2019/07/18/5d30829ceb6bb76611.png","color":"#111","link":"post/arc-29","tags":["React"],"categories":["前端"],"updated":"2019-07-20T02:12:54.500Z","content":"<p>This guide’s purpose is to explain the mental model to have when using React Router. We call it “Dynamic Routing”, which is quite different from the “Static Routing” you’re probably more familiar with.<br><a id=\"more\"></a></p>\n<blockquote>\n<p>React 是完整的 React 路由解决方案</p>\n</blockquote>\n<p>一句话，React 用于保持 URL 和 UI 同步，保证每次 URL 的改变都带来 UI 的变化，并且在单页面应用程序中，这样的改变应该是驱动页面跳转的最佳方式。</p>\n<p><em>本文基于 React-Router v4 英文文档，私以为每个人都应该使用 v4 因为该版本的 Router 思想高度契合 React 基本思想</em></p>\n<h2 id=\"Dynamic-Routing\">Dynamic Routing<a href=\"post/arc-29#Dynamic-Routing\"></a></h2><p>When we say dynamic routing, we mean routing that takes place<strong>as your app is rendering</strong>, not in a configuration or convention outside of a running app. That means almost everything is a component in React Router. </p>\n<p>React Router v4 开始启用了动态路由，区别于其他的两大框架的路由解决方案，按照作者的看法来说，v4 的动态路由才是更符合 React 哲学的路由解决方案，彻底抛弃了声明式路由列表之后，动态路由可以让我们的应用构建过程更加灵活，无论什么情况下只要需要变化的场景都可以随时引入一个 Route 来通过 URL 控制，而不需要单独维护一个静态的路由配置文件。按照作者的 React Router 哲学来说，任何一个路由在使用时与普通的 component 没有任何区别，因此路由的定义和使用都非常的符合 React 的编程风格。</p>\n<h3 id=\"Responsive-Routes\">Responsive Routes<a href=\"post/arc-29#Responsive-Routes\"></a></h3><p>这是一个检测屏幕大小自动更改路由策略的例子，我们可以看出任何一个 Route 组件实际在使用的时候和普通的 component 是没啥区别的。</p>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> App = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> (</span><br><span class=\"line\">  &lt;AppLayout&gt;</span><br><span class=\"line\">    &lt;Route path=<span class=\"string\">\"/invoices\"</span> component=&#123;Invoices&#125; /&gt;</span><br><span class=\"line\">  &lt;<span class=\"regexp\">/AppLayout&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">);</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">const Invoices = () =&gt; (</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;Layout&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &#123;/</span>* always show the nav *<span class=\"regexp\">/&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;InvoicesNav /</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;Media query=&#123;PRETTY_SMALL&#125;&gt;</span><br><span class=\"line\">      &#123;screenIsSmall =&gt;</span><br><span class=\"line\">        screenIsSmall ? (</span><br><span class=\"line\">          <span class=\"comment\">// small screen has no redirect</span></span><br><span class=\"line\">          &lt;Switch&gt;</span><br><span class=\"line\">            &lt;Route exact path=<span class=\"string\">\"/invoices/dashboard\"</span> component=&#123;Dashboard&#125; /&gt;</span><br><span class=\"line\">            &lt;Route path=<span class=\"string\">\"/invoices/:id\"</span> component=&#123;Invoice&#125; /&gt;</span><br><span class=\"line\">          &lt;<span class=\"regexp\">/Switch&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        ) : (</span></span><br><span class=\"line\"><span class=\"regexp\">          /</span><span class=\"regexp\">/ large screen does!</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;Switch&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            &lt;Route exact path=\"/i</span>nvoices/dashboard<span class=\"string\">\" component=&#123;Dashboard&#125; /&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;Route path=\"</span>/invoices/:id<span class=\"string\">\" component=&#123;Invoice&#125; /&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;Redirect from=\"</span>/invoices<span class=\"string\">\" to=\"</span>/invoices/dashboard<span class=\"string\">\" /&gt;</span></span><br><span class=\"line\"><span class=\"string\">          &lt;/Switch&gt;</span></span><br><span class=\"line\"><span class=\"string\">        )</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/Media&gt;</span></span><br><span class=\"line\"><span class=\"string\">  &lt;/Layout&gt;</span></span><br><span class=\"line\"><span class=\"string\">);</span></span><br></pre></td></tr></table></div></figure>\n<p>This is just one example. There are many others we could discuss but we’ll sum it up with this advice: To get your intuition in line with React Router’s, think about components, not static routes. Think about how to solve the problem with React’s declarative composability because nearly every “React Router question” is probably a “React question”.</p>\n<h2 id=\"Redux-Integration\">Redux Integration<a href=\"post/arc-29#Redux-Integration\"></a></h2><p>与 Redux 的集成。如果我们将 React Router 的几个核心 state 存放到 Redux 的 store 中就基本可以完成与 Redux  的深度集成，但是尽量在集成之前仔细思考这样会解决那些痛点，因为其实不需要那么深度的集成二者之间就已经可以很好的协同工作了。</p>\n<p>集成的过程中可能会出现以下问题。</p>\n<h3 id=\"忽略更新\">忽略更新<a href=\"post/arc-29#忽略更新\"></a></h3><p>Generally, React Router and Redux work just fine together. Occasionally though, an app can have a component that doesn’t update when the location changes (child routes or active nav links don’t update).</p>\n<p>This happens if:</p>\n<ol>\n<li>The component is connected to redux via <code>connect()(Comp)</code>.</li>\n<li>The component is<strong>not</strong>a “route component”, meaning it is not rendered like so:<code>&lt;Route component={SomeConnectedThing}/&gt;</code><br>The problem is that Redux implements shouldComponentUpdate and there’s no indication that anything has changed if it isn’t receiving props from the router. This is straightforward to fix. Find where youconnectyour component and wrap it in withRouter.</li>\n</ol>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// before</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> connect(mapStateToProps)(Something)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// after</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; withRouter &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react-router-dom'</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> withRouter(connect(mapStateToProps)(Something))</span><br></pre></td></tr></table></div></figure>\n<h3 id=\"深度集成\">深度集成<a href=\"post/arc-29#深度集成\"></a></h3><p>Some folks want to:</p>\n<ol>\n<li>Synchronize the routing data with, and accessed from, the store.</li>\n<li>Be able to navigate by dispatching actions.</li>\n<li>Have support for time travel debugging for route changes in the Redux devtools.<br>All of this requires deeper integration.<br>Our recommendation is<strong>not to keep your routes in your Redux store at all</strong>. Reasoning:</li>\n<li>Routing data is already a prop of most of your components that care about it. Whether it comes from the store or the router, your component’s code is largely the same.</li>\n<li>In most cases, you can useLink,NavLinkandRedirectto perform navigation actions. Sometimes you might also need to navigate programmatically, after some asynchronous task that was originally initiated by an action. For example, you might dispatch an action when the user submits a login form. Your <a href=\"https://github.com/reduxjs/redux-thunk\" target=\"_blank\" rel=\"noopener\">thunk</a> , <a href=\"https://redux-saga.js.org/\" target=\"_blank\" rel=\"noopener\">saga</a> or other async handler then authenticates the credentials,<em>then</em>it needs to somehow navigate to a new page if successful. The solution here is simply to include thehistoryobject (provided to all route components) in the payload of the action, and your async handler can use this to navigate when appropriate.</li>\n<li>Route changes are unlikely to matter for time travel debugging. The only obvious case is to debug issues with your router/store synchronization, and this problem goes away if you don’t synchronize them at all.</li>\n</ol>\n<h2 id=\"API\">API<a href=\"post/arc-29#API\"></a></h2><h3 id=\"Route-props\">Route props<a href=\"post/arc-29#Route-props\"></a></h3><p>All three <a href=\"https://reacttraining.com/react-router/core/api/Route/route-render-methods\" target=\"_blank\" rel=\"noopener\">render methods</a> will be passed the same three route props</p>\n<ul>\n<li><a href=\"https://reacttraining.com/react-router/core/api/match\" target=\"_blank\" rel=\"noopener\">match</a> </li>\n<li><a href=\"https://reacttraining.com/react-router/core/api/location\" target=\"_blank\" rel=\"noopener\">location</a> </li>\n<li><a href=\"https://reacttraining.com/react-router/core/api/history\" target=\"_blank\" rel=\"noopener\">history</a> </li>\n</ul>\n<p>以上三个属性都可以通过与 Router 相连的组件中的 <code>this.props</code> 中获取得到，这三个也是最常用的控制路由的属性。</p>\n<h3 id=\"history\">history<a href=\"post/arc-29#history\"></a></h3><p>The term “history” and “history object” in this documentation refers to <a href=\"https://github.com/ReactTraining/history\" target=\"_blank\" rel=\"noopener\">the history package</a> , which is one of only 2 major dependencies of React Router (besides React itself), and which provides several different implementations for managing session history in JavaScript in various environments.<br>The following terms are also used:</p>\n<ul>\n<li>“browser history” - A DOM-specific implementation, useful in web browsers that support the HTML5 history API</li>\n<li>“hash history” - A DOM-specific implementation for legacy web browsers</li>\n<li>“memory history” - An in-memory history implementation, useful in testing and non-DOM environments like React Native</li>\n</ul>\n<p>historyobjects typically have the following properties and methods:</p>\n<ul>\n<li>length- (number) The number of entries in the history stack</li>\n<li>action- (string) The current action (PUSH,REPLACE, orPOP)</li>\n<li>location- (object) The current location. May have the following properties:<ul>\n<li>pathname- (string) The path of the URL</li>\n<li>search- (string) The URL query string</li>\n<li>hash- (string) The URL hash fragment</li>\n<li>state- (object) location-specific state that was provided to e.g.push(path, state)when this location was pushed onto the stack. Only available in browser and memory history.</li>\n</ul>\n</li>\n<li>push(path, [state])- (function) Pushes a new entry onto the history stack</li>\n<li>replace(path, [state])- (function) Replaces the current entry on the history stack</li>\n<li>go(n)- (function) Moves the pointer in the history stack bynentries</li>\n<li>goBack()- (function) Equivalent togo(-1)</li>\n<li>goForward()- (function) Equivalent togo(1)</li>\n<li>block(prompt)- (function) Prevents navigation (see <a href=\"https://github.com/ReactTraining/history#blocking-transitions\" target=\"_blank\" rel=\"noopener\">the history docs</a> )</li>\n</ul>\n<p><strong>history is mutable</strong></p>\n<p>The history object is mutable. Therefore it is recommended to access the <a href=\"https://reacttraining.com/react-router/core/api/location\" target=\"_blank\" rel=\"noopener\">location</a> from the render props of <a href=\"https://reacttraining.com/react-router/core/api/Route\" target=\"_blank\" rel=\"noopener\"><route></route></a> , not from history.location. This ensures your assumptions about React are correct in lifecycle hooks.<br>For example:</p>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Comp</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  componentDidUpdate(prevProps) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// will be true</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> locationChanged = <span class=\"keyword\">this</span>.props.location !== prevProps.location;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// INCORRECT, will *always* be false because history is mutable.</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> locationChanged =</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.props.history.location !== prevProps.history.location;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Route component=&#123;Comp&#125; /&gt;;</span><br></pre></td></tr></table></div></figure>\n<h3 id=\"location\">location<a href=\"post/arc-29#location\"></a></h3><p>Locations represent where the app is now, where you want it to go, or even where it was. It looks like this:</p>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  key: <span class=\"string\">'ac3df4'</span>, <span class=\"comment\">// not with HashHistory!</span></span><br><span class=\"line\">  pathname: <span class=\"string\">'/somewhere'</span></span><br><span class=\"line\">  search: <span class=\"string\">'?some=search-string'</span>,</span><br><span class=\"line\">  hash: <span class=\"string\">'#howdy'</span>,</span><br><span class=\"line\">  state: &#123;</span><br><span class=\"line\">    [userDefined]: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<p>The router will provide you with a location object in a few places:</p>\n<ul>\n<li><a href=\"https://reacttraining.com/react-router/core/api/Route/component\" target=\"_blank\" rel=\"noopener\">Route component</a> as <code>this.props.location</code></li>\n<li><a href=\"https://reacttraining.com/react-router/core/api/Route/render-func\" target=\"_blank\" rel=\"noopener\">Route render</a> as <code>({ location }) =&gt; ()</code></li>\n<li><a href=\"https://reacttraining.com/react-router/core/api/Route/children-func\" target=\"_blank\" rel=\"noopener\">Route children</a> as <code>({ location }) =&gt; ()</code></li>\n<li><a href=\"https://reacttraining.com/react-router/core/api/withRouter\" target=\"_blank\" rel=\"noopener\">withRouter</a> as <code>this.props.location</code><br>It is also found on <code>history.location</code> but you shouldn’t use that because its mutable. You can read more about that in the <a href=\"https://reacttraining.com/react-router/core/api/history\" target=\"_blank\" rel=\"noopener\">history</a> doc.<br>A location object is never mutated so you can use it in the lifecycle hooks to determine when navigation happens, this is really useful for data fetching and animation.</li>\n</ul>\n<p>location 的最常用的场景就是在组件的 update 钩子中来判断当前 URL 是否改变，并进行相应的 data fetch 或者是动画渲染。<br>同时我们可以通过 location 来获取到当前 URL 中的 pathname 和 query 对象以及 hash tag。<br>注意不要使用 history 中的 location 因为 history 是个可变的对象，使用 history 比较的话，location 总是会改变的。</p>\n<h3 id=\"match\">match<a href=\"post/arc-29#match\"></a></h3><p>Amatchobject contains information about how a<route path>matched the URL.matchobjects contain the following properties:</route></p>\n<ul>\n<li>params- (object) Key/value pairs parsed from the URL corresponding to the dynamic segments of the path</li>\n<li>isExact- (boolean)trueif the entire URL was matched (no trailing characters)</li>\n<li>path- (string) The path pattern used to match. Useful for building nested<route>s</route></li>\n<li>url- (string) The matched portion of the URL. Useful for building nested<link>s<br>You’ll have access tomatchobjects in various places:</li>\n<li><a href=\"https://reacttraining.com/react-router/core/api/Route/component\" target=\"_blank\" rel=\"noopener\">Route component</a> as <code>this.props.match</code></li>\n<li><a href=\"https://reacttraining.com/react-router/core/api/Route/render-func\" target=\"_blank\" rel=\"noopener\">Route render</a> as <code>({ match }) =&gt; ()</code></li>\n<li><a href=\"https://reacttraining.com/react-router/core/api/Route/children-func\" target=\"_blank\" rel=\"noopener\">Route children</a> as <code>({ match }) =&gt; ()</code></li>\n<li><a href=\"https://reacttraining.com/react-router/core/api/withRouter\" target=\"_blank\" rel=\"noopener\">withRouter</a> as <code>this.props.match</code></li>\n<li><a href=\"https://reacttraining.com/react-router/core/api/matchPath\" target=\"_blank\" rel=\"noopener\">matchPath</a> as the return value<br>If a Route does not have a path, and therefore always matches, you’ll get the closest parent match. Same goes for <code>withRouter</code>.<br>常用场景在于获取路由中的动态参数 <code>this.props.match.params</code></li>\n</ul>\n<h3 id=\"withRouter\">withRouter<a href=\"post/arc-29#withRouter\"></a></h3><p>You can get access to the <a href=\"https://reacttraining.com/react-router/core/api/history\" target=\"_blank\" rel=\"noopener\">history</a> object’s properties and the closest <a href=\"https://reacttraining.com/react-router/core/api/Route\" target=\"_blank\" rel=\"noopener\"><route></route></a> ’s <a href=\"https://reacttraining.com/react-router/core/api/match\" target=\"_blank\" rel=\"noopener\">match</a> via the <code>withRouter</code> higher-order component.withRouter will pass updated match,location, and history props to the wrapped component whenever it renders.</p>\n<p>Important Note<br>withRouterdoes not subscribe to location changes like React Redux’sconnectdoes for state changes. Instead, re-renders after location changes propagate out from the<router>component. This means thatwithRouterdoes<em>not</em>re-render on route transitions unless its parent component re-renders.</router></p>\n<h3 id=\"children-func\">children: func<a href=\"post/arc-29#children-func\"></a></h3><p>Sometimes you need to render whether the path matches the location or not. In these cases, you can use the function <code>children</code> prop. It works exactly like render except that it gets called whether there is a match or not.<br><code>children</code> 是除了 component 和 render 的第三种组件路由绑定方式，不同点在于无论 path 是否 match 他都会渲染，可以在进一步判断是否 match 从而进行不同的对策。</p>\n<p>The children render prop receives all the same <a href=\"https://reacttraining.com/react-router/core/api/Route/route-props\" target=\"_blank\" rel=\"noopener\">route props</a> as the component and render methods, except when a route fails to match the URL, then match is null. This allows you to dynamically adjust your UI based on whether or not the route matches. Here we’re adding anactiveclass if the route matches</p>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;ul&gt;</span><br><span class=\"line\">  &lt;ListItemLink to=<span class=\"string\">\"/somewhere\"</span> /&gt;</span><br><span class=\"line\">  &lt;ListItemLink to=<span class=\"string\">\"/somewhere-else\"</span> /&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/ul&gt;;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">const ListItemLink = (&#123; to, ...rest &#125;) =&gt; (</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;Route</span></span><br><span class=\"line\"><span class=\"regexp\">    path=&#123;to&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">    children=&#123;(&#123; match &#125;) =&gt; (</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;li className=&#123;match ? \"active\" : \"\"&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;Link to=&#123;to&#125; &#123;...rest&#125; /</span>&gt;</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/li&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    )&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">  /</span>&gt;</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Route children=&#123;(&#123; match, ...rest &#125;) =&gt; (</span><br><span class=\"line\">  &#123;<span class=\"comment\">/* Animate will always render, so you can use lifecycles</span></span><br><span class=\"line\"><span class=\"comment\">      to animate its child in and out */</span>&#125;</span><br><span class=\"line\">  &lt;Animate&gt;</span><br><span class=\"line\">    &#123;match &amp;&amp; &lt;Something &#123;...rest&#125;/&gt;&#125;</span><br><span class=\"line\">  &lt;/Animate&gt;</span><br><span class=\"line\">)&#125;/&gt;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"Examples\">Examples<a href=\"post/arc-29#Examples\"></a></h2><h3 id=\"Nested-Routes\">Nested Routes<a href=\"post/arc-29#Nested-Routes\"></a></h3><p>嵌套路由</p>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> App = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> (</span><br><span class=\"line\">  &lt;BrowserRouter&gt;</span><br><span class=\"line\">    &#123;<span class=\"comment\">/* here's a div */</span>&#125;</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &#123;<span class=\"comment\">/* here's a Route */</span>&#125;</span><br><span class=\"line\">      &lt;Route path=<span class=\"string\">\"/tacos\"</span> component=&#123;Tacos&#125; /&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;/</span>BrowserRouter&gt;</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// when the url matches `/tacos` this component renders</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Tacos = <span class=\"function\">(<span class=\"params\">&#123; match &#125;</span>) =&gt;</span> (</span><br><span class=\"line\">  <span class=\"comment\">// here's a nested div</span></span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &#123;<span class=\"comment\">/* here's a nested Route,</span></span><br><span class=\"line\"><span class=\"comment\">        match.url helps us make a relative path */</span>&#125;</span><br><span class=\"line\">    &lt;Route path=&#123;match.url + <span class=\"string\">\"/carnitas\"</span>&#125; component=&#123;Carnitas&#125; /&gt;</span><br><span class=\"line\">  &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">);</span></span><br></pre></td></tr></table></div></figure>\n<h3 id=\"Auth\">Auth<a href=\"post/arc-29#Auth\"></a></h3><p>路由鉴权</p>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">  BrowserRouter <span class=\"keyword\">as</span> Router,</span><br><span class=\"line\">  Route,</span><br><span class=\"line\">  Link,</span><br><span class=\"line\">  Redirect,</span><br><span class=\"line\">  withRouter</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">\"react-router-dom\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">////////////////////////////////////////////////////////////</span></span><br><span class=\"line\"><span class=\"comment\">// 1. Click the public page</span></span><br><span class=\"line\"><span class=\"comment\">// 2. Click the protected page</span></span><br><span class=\"line\"><span class=\"comment\">// 3. Log in</span></span><br><span class=\"line\"><span class=\"comment\">// 4. Click the back button, note the URL each time</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">AuthExample</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;Router&gt;</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;AuthButton /&gt;</span><br><span class=\"line\">        &lt;ul&gt;</span><br><span class=\"line\">          &lt;li&gt;</span><br><span class=\"line\">            &lt;Link to=<span class=\"string\">\"/public\"</span>&gt;Public Page&lt;<span class=\"regexp\">/Link&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>li&gt;</span><br><span class=\"line\">          &lt;li&gt;</span><br><span class=\"line\">            &lt;Link to=<span class=\"string\">\"/protected\"</span>&gt;Protected Page&lt;<span class=\"regexp\">/Link&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>li&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/ul&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;Route path=\"/</span>public<span class=\"string\">\" component=&#123;Public&#125; /&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;Route path=\"</span>/login<span class=\"string\">\" component=&#123;Login&#125; /&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;PrivateRoute path=\"</span>/protected<span class=\"string\">\" component=&#123;Protected&#125; /&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/Router&gt;</span></span><br><span class=\"line\"><span class=\"string\">  );</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">const fakeAuth = &#123;</span></span><br><span class=\"line\"><span class=\"string\">  isAuthenticated: false,</span></span><br><span class=\"line\"><span class=\"string\">  authenticate(cb) &#123;</span></span><br><span class=\"line\"><span class=\"string\">    this.isAuthenticated = true;</span></span><br><span class=\"line\"><span class=\"string\">    setTimeout(cb, 100); // fake async</span></span><br><span class=\"line\"><span class=\"string\">  &#125;,</span></span><br><span class=\"line\"><span class=\"string\">  signout(cb) &#123;</span></span><br><span class=\"line\"><span class=\"string\">    this.isAuthenticated = false;</span></span><br><span class=\"line\"><span class=\"string\">    setTimeout(cb, 100);</span></span><br><span class=\"line\"><span class=\"string\">  &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">const AuthButton = withRouter(</span></span><br><span class=\"line\"><span class=\"string\">  (&#123; history &#125;) =&gt;</span></span><br><span class=\"line\"><span class=\"string\">    fakeAuth.isAuthenticated ? (</span></span><br><span class=\"line\"><span class=\"string\">      &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"string\">        Welcome!&#123;\"</span> <span class=\"string\">\"&#125;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;button</span></span><br><span class=\"line\"><span class=\"string\">          onClick=&#123;() =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"string\">            fakeAuth.signout(() =&gt; history.push(\"</span>/<span class=\"string\">\"));</span></span><br><span class=\"line\"><span class=\"string\">          &#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">        &gt;</span></span><br><span class=\"line\"><span class=\"string\">          Sign out</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/button&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"string\">    ) : (</span></span><br><span class=\"line\"><span class=\"string\">      &lt;p&gt;You are not logged in.&lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"string\">    )</span></span><br><span class=\"line\"><span class=\"string\">);</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">function PrivateRoute(&#123; component: Component, ...rest &#125;) &#123;</span></span><br><span class=\"line\"><span class=\"string\">  return (</span></span><br><span class=\"line\"><span class=\"string\">    &lt;Route</span></span><br><span class=\"line\"><span class=\"string\">      &#123;...rest&#125;</span></span><br><span class=\"line\"><span class=\"string\">      render=&#123;props =&gt;</span></span><br><span class=\"line\"><span class=\"string\">        fakeAuth.isAuthenticated ? (</span></span><br><span class=\"line\"><span class=\"string\">          &lt;Component &#123;...props&#125; /&gt;</span></span><br><span class=\"line\"><span class=\"string\">        ) : (</span></span><br><span class=\"line\"><span class=\"string\">          &lt;Redirect</span></span><br><span class=\"line\"><span class=\"string\">\t\t\t  // 用 state 可以携带重定向信息</span></span><br><span class=\"line\"><span class=\"string\">            to=&#123;&#123;</span></span><br><span class=\"line\"><span class=\"string\">              pathname: \"</span>/login<span class=\"string\">\",</span></span><br><span class=\"line\"><span class=\"string\">              state: &#123; from: props.location &#125;</span></span><br><span class=\"line\"><span class=\"string\">            &#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">          /&gt;</span></span><br><span class=\"line\"><span class=\"string\">        )</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    /&gt;</span></span><br><span class=\"line\"><span class=\"string\">  );</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">function Public() &#123;</span></span><br><span class=\"line\"><span class=\"string\">  return &lt;h3&gt;Public&lt;/h3&gt;;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">function Protected() &#123;</span></span><br><span class=\"line\"><span class=\"string\">  return &lt;h3&gt;Protected&lt;/h3&gt;;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">class Login extends Component &#123;</span></span><br><span class=\"line\"><span class=\"string\">  state = &#123; redirectToReferrer: false &#125;;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">  login = () =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"string\">    fakeAuth.authenticate(() =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"string\">      this.setState(&#123; redirectToReferrer: true &#125;);</span></span><br><span class=\"line\"><span class=\"string\">    &#125;);</span></span><br><span class=\"line\"><span class=\"string\">  &#125;;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">  render() &#123;</span></span><br><span class=\"line\"><span class=\"string\">    // state 通过 location 携带</span></span><br><span class=\"line\"><span class=\"string\">    let &#123; from &#125; = this.props.location.state || &#123; from: &#123; pathname: \"</span>/<span class=\"string\">\" &#125; &#125;;</span></span><br><span class=\"line\"><span class=\"string\">    let &#123; redirectToReferrer &#125; = this.state;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    if (redirectToReferrer) return &lt;Redirect to=&#123;from&#125; /&gt;;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    return (</span></span><br><span class=\"line\"><span class=\"string\">      &lt;div&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;p&gt;You must log in to view the page at &#123;from.pathname&#125;&lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;button onClick=&#123;this.login&#125;&gt;Log in&lt;/button&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">    );</span></span><br><span class=\"line\"><span class=\"string\">  &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">export default AuthExample;</span></span><br></pre></td></tr></table></div></figure>\n<h3 id=\"Preventing-Transitions\">Preventing Transitions<a href=\"post/arc-29#Preventing-Transitions\"></a></h3><p>路由跳转前提示，使用 <code>Prompt</code> 组件实现</p>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">PreventingTransitionsExample</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;Router&gt;</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;ul&gt;</span><br><span class=\"line\">          &lt;li&gt;</span><br><span class=\"line\">            &lt;Link to=<span class=\"string\">\"/\"</span>&gt;Form&lt;<span class=\"regexp\">/Link&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>li&gt;</span><br><span class=\"line\">          &lt;li&gt;</span><br><span class=\"line\">            &lt;Link to=<span class=\"string\">\"/one\"</span>&gt;One&lt;<span class=\"regexp\">/Link&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>li&gt;</span><br><span class=\"line\">          &lt;li&gt;</span><br><span class=\"line\">            &lt;Link to=<span class=\"string\">\"/two\"</span>&gt;Two&lt;<span class=\"regexp\">/Link&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>li&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/ul&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;Route path=\"/</span><span class=\"string\">\" exact component=&#123;Form&#125; /&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;Route path=\"</span>/one<span class=\"string\">\" render=&#123;() =&gt; &lt;h3&gt;One&lt;/h3&gt;&#125; /&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;Route path=\"</span>/two<span class=\"string\">\" render=&#123;() =&gt; &lt;h3&gt;Two&lt;/h3&gt;&#125; /&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/Router&gt;</span></span><br><span class=\"line\"><span class=\"string\">  );</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">class Form extends Component &#123;</span></span><br><span class=\"line\"><span class=\"string\">  state = &#123; isBlocking: false &#125;;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">  render() &#123;</span></span><br><span class=\"line\"><span class=\"string\">    let &#123; isBlocking &#125; = this.state;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    return (</span></span><br><span class=\"line\"><span class=\"string\">      &lt;form</span></span><br><span class=\"line\"><span class=\"string\">        onSubmit=&#123;event =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"string\">          event.preventDefault();</span></span><br><span class=\"line\"><span class=\"string\">          event.target.reset();</span></span><br><span class=\"line\"><span class=\"string\">          this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"string\">            isBlocking: false</span></span><br><span class=\"line\"><span class=\"string\">          &#125;);</span></span><br><span class=\"line\"><span class=\"string\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">      &gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;Prompt</span></span><br><span class=\"line\"><span class=\"string\">          when=&#123;isBlocking&#125;</span></span><br><span class=\"line\"><span class=\"string\">          message=&#123;location =&gt;</span></span><br><span class=\"line\"><span class=\"string\">            `Are you sure you want to go to $&#123;location.pathname&#125;`</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        /&gt;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">        &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"string\">          Blocking?&#123;\"</span> <span class=\"string\">\"&#125;</span></span><br><span class=\"line\"><span class=\"string\">          &#123;isBlocking ? \"</span>Yes, click a link or the back button<span class=\"string\">\" : \"</span>Nope<span class=\"string\">\"&#125;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">        &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"string\">          &lt;input</span></span><br><span class=\"line\"><span class=\"string\">            size=\"</span><span class=\"number\">50</span><span class=\"string\">\"</span></span><br><span class=\"line\"><span class=\"string\">            placeholder=\"</span>type something to block transitions<span class=\"string\">\"</span></span><br><span class=\"line\"><span class=\"string\">            onChange=&#123;event =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"string\">              this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"string\">                isBlocking: event.target.value.length &gt; 0</span></span><br><span class=\"line\"><span class=\"string\">              &#125;);</span></span><br><span class=\"line\"><span class=\"string\">            &#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">          /&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">        &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"string\">          &lt;button&gt;Submit to stop blocking&lt;/button&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/p&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;/form&gt;</span></span><br><span class=\"line\"><span class=\"string\">    );</span></span><br><span class=\"line\"><span class=\"string\">  &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">export default PreventingTransitionsExample;</span></span><br></pre></td></tr></table></div></figure>\n<h3 id=\"SideBar\">SideBar<a href=\"post/arc-29#SideBar\"></a></h3><figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; BrowserRouter <span class=\"keyword\">as</span> Router, Route, Link &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"react-router-dom\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Each logical \"route\" has two components, one for</span></span><br><span class=\"line\"><span class=\"comment\">// the sidebar and one for the main area. We want to</span></span><br><span class=\"line\"><span class=\"comment\">// render both of them in different places when the</span></span><br><span class=\"line\"><span class=\"comment\">// path matches the current URL.</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> routes = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    path: <span class=\"string\">\"/\"</span>,</span><br><span class=\"line\">    exact: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    sidebar: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &lt;div&gt;home!&lt;/div&gt;,</span><br><span class=\"line\">    main: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &lt;h2&gt;Home&lt;<span class=\"regexp\">/h2&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &#125;,</span></span><br><span class=\"line\"><span class=\"regexp\">  &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">    path: \"/</span>bubblegum<span class=\"string\">\",</span></span><br><span class=\"line\"><span class=\"string\">    sidebar: () =&gt; &lt;div&gt;bubblegum!&lt;/div&gt;,</span></span><br><span class=\"line\"><span class=\"string\">    main: () =&gt; &lt;h2&gt;Bubblegum&lt;/h2&gt;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;,</span></span><br><span class=\"line\"><span class=\"string\">  &#123;</span></span><br><span class=\"line\"><span class=\"string\">    path: \"</span>/shoelaces<span class=\"string\">\",</span></span><br><span class=\"line\"><span class=\"string\">    sidebar: () =&gt; &lt;div&gt;shoelaces!&lt;/div&gt;,</span></span><br><span class=\"line\"><span class=\"string\">    main: () =&gt; &lt;h2&gt;Shoelaces&lt;/h2&gt;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;</span></span><br><span class=\"line\"><span class=\"string\">];</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">function SidebarExample() &#123;</span></span><br><span class=\"line\"><span class=\"string\">  return (</span></span><br><span class=\"line\"><span class=\"string\">    &lt;Router&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;div style=&#123;&#123; display: \"</span>flex<span class=\"string\">\" &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;div</span></span><br><span class=\"line\"><span class=\"string\">          style=&#123;&#123;</span></span><br><span class=\"line\"><span class=\"string\">            padding: \"</span><span class=\"number\">10</span>px<span class=\"string\">\",</span></span><br><span class=\"line\"><span class=\"string\">            width: \"</span><span class=\"number\">40</span>%<span class=\"string\">\",</span></span><br><span class=\"line\">            background: \"#f0f0f0\"</span><br><span class=\"line\">          &#125;&#125;</span><br><span class=\"line\">        &gt;</span><br><span class=\"line\">          &lt;ul style=&#123;&#123; <span class=\"attr\">listStyleType</span>: <span class=\"string\">\"none\"</span>, <span class=\"attr\">padding</span>: <span class=\"number\">0</span> &#125;&#125;&gt;</span><br><span class=\"line\">            &lt;li&gt;</span><br><span class=\"line\">              &lt;Link to=<span class=\"string\">\"/\"</span>&gt;Home&lt;<span class=\"regexp\">/Link&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            &lt;/</span>li&gt;</span><br><span class=\"line\">            &lt;li&gt;</span><br><span class=\"line\">              &lt;Link to=<span class=\"string\">\"/bubblegum\"</span>&gt;Bubblegum&lt;<span class=\"regexp\">/Link&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            &lt;/</span>li&gt;</span><br><span class=\"line\">            &lt;li&gt;</span><br><span class=\"line\">              &lt;Link to=<span class=\"string\">\"/shoelaces\"</span>&gt;Shoelaces&lt;<span class=\"regexp\">/Link&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            &lt;/</span>li&gt;</span><br><span class=\"line\">          &lt;<span class=\"regexp\">/ul&gt;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">          &#123;routes.map((route, index) =&gt; (</span></span><br><span class=\"line\"><span class=\"regexp\">            /</span><span class=\"regexp\">/ You can render a &lt;Route&gt; in as many places</span></span><br><span class=\"line\"><span class=\"regexp\">            /</span><span class=\"regexp\">/ as you want in your app. It will render along</span></span><br><span class=\"line\"><span class=\"regexp\">            /</span><span class=\"regexp\">/ with any other &lt;Route&gt;s that also match the URL.</span></span><br><span class=\"line\"><span class=\"regexp\">            /</span><span class=\"regexp\">/ So, a sidebar or breadcrumbs or anything else</span></span><br><span class=\"line\"><span class=\"regexp\">            /</span><span class=\"regexp\">/ that requires you to render multiple things</span></span><br><span class=\"line\"><span class=\"regexp\">            /</span><span class=\"regexp\">/ in multiple places at the same URL is nothing</span></span><br><span class=\"line\"><span class=\"regexp\">            /</span><span class=\"regexp\">/ more than multiple &lt;Route&gt;s.</span></span><br><span class=\"line\"><span class=\"regexp\">            &lt;Route</span></span><br><span class=\"line\"><span class=\"regexp\">              key=&#123;index&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">              path=&#123;route.path&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">              exact=&#123;route.exact&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">              component=&#123;route.sidebar&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">            /</span>&gt;</span><br><span class=\"line\">          ))&#125;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;div style=&#123;&#123; flex: 1, padding: \"10px\" &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &#123;routes.map((route, index) =&gt; (</span></span><br><span class=\"line\"><span class=\"regexp\">            /</span><span class=\"regexp\">/ Render more &lt;Route&gt;s with the same paths as</span></span><br><span class=\"line\"><span class=\"regexp\">            /</span><span class=\"regexp\">/ above, but different components this time.</span></span><br><span class=\"line\"><span class=\"regexp\">            &lt;Route</span></span><br><span class=\"line\"><span class=\"regexp\">              key=&#123;index&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">              path=&#123;route.path&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">              exact=&#123;route.exact&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">              component=&#123;route.main&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">            /</span>&gt;</span><br><span class=\"line\">          ))&#125;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/Router&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">export default SidebarExample;</span></span><br></pre></td></tr></table></div></figure>\n<h2 id=\"Reference\">Reference<a href=\"post/arc-29#Reference\"></a></h2><p><a href=\"https://reacttraining.com/react-router/web/guides/quick-start\" target=\"_blank\" rel=\"noopener\">React Router: Declarative Routing for React.js</a><br><a href=\"https://reacttraining.com/react-router/core/guides/philosophy\" target=\"_blank\" rel=\"noopener\">React Router: Declarative Routing for React.js-Philosophy </a><br>  <a href=\"https://reacttraining.com/react-router/core/guides/redux-integration\" target=\"_blank\" rel=\"noopener\">Redux Integration</a><br><a href=\"https://zhuanlan.zhihu.com/p/28585911\" target=\"_blank\" rel=\"noopener\">你不知道的 React Router 4 - 知乎</a><br><a href=\"https://juejin.im/post/5a641747518825732d7fb25f\" target=\"_blank\" rel=\"noopener\">React Router 4 简介及其背后的路由哲学 - 掘金</a></p>\n","next":{"title":"Redux 哲学","link":"post/arc-28"},"plink":"https://xkeith.space/post/arc-29/","toc":[{"title":"Dynamic Routing","id":"Dynamic-Routing","index":"1","children":[{"title":"Responsive Routes","id":"Responsive-Routes","index":"1.1"}]},{"title":"Redux Integration","id":"Redux-Integration","index":"2","children":[{"title":"忽略更新","id":"忽略更新","index":"2.1"},{"title":"深度集成","id":"深度集成","index":"2.2"}]},{"title":"API","id":"API","index":"3","children":[{"title":"Route props","id":"Route-props","index":"3.1"},{"title":"history","id":"history","index":"3.2"},{"title":"location","id":"location","index":"3.3"},{"title":"match","id":"match","index":"3.4"},{"title":"withRouter","id":"withRouter","index":"3.5"},{"title":"children: func","id":"children-func","index":"3.6"}]},{"title":"Examples","id":"Examples","index":"4","children":[{"title":"Nested Routes","id":"Nested-Routes","index":"4.1"},{"title":"Auth","id":"Auth","index":"4.2"},{"title":"Preventing Transitions","id":"Preventing-Transitions","index":"4.3"},{"title":"SideBar","id":"SideBar","index":"4.4"}]},{"title":"Reference","id":"Reference","index":"5"}]}